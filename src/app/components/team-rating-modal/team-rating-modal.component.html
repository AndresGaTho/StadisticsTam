<div *ngIf="showModal" class="modal-overlay" (click)="onClose()">
    <div class="modal-content team-rating-modal" (click)="$event.stopPropagation()">
        <div class="modal-header">
            <div class="modal-title">
                <div class="modal-icon">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M17 21V19C17 17.9391 16.5786 16.9217 15.8284 16.1716C15.0783 15.4214 14.0609 15 13 15H5C3.93913 15 2.92172 15.4214 2.17157 16.1716C1.42143 16.9217 1 17.9391 1 19V21M23 21V19C22.9993 18.1137 22.7044 17.2528 22.1614 16.5523C21.6184 15.8519 20.8581 15.3516 20 15.13M16 3.13C16.8604 3.35031 17.623 3.85071 18.1676 4.55232C18.7122 5.25392 19.0078 6.11683 19.0078 7.005C19.0078 7.89318 18.7122 8.75608 18.1676 9.45769C17.623 10.1593 16.8604 10.6597 16 10.88M13 7C13 9.20914 11.2091 11 9 11C6.79086 11 5 9.20914 5 7C5 4.79086 6.79086 3 9 3C11.2091 3 13 4.79086 13 7Z"
                            stroke="currentColor" stroke-width="2" />
                    </svg>
                </div>
                <h3>Evaluación del Equipo Arbitral</h3>
            </div>
            <button class="modal-close" (click)="onClose()">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" />
                </svg>
            </button>
        </div>

        <div class="modal-body">
            <!-- Resumen del Equipo -->
            <div class="team-summary">
                <div class="summary-stats">
                    <div class="stat-card">
                        <span class="stat-number">{{ referees.length }}</span>
                        <span class="stat-label">Árbitros</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">{{ getAverageRating() }}</span>
                        <span class="stat-label">Rating Promedio</span>
                    </div>
                    <div class="stat-card">
                        <span class="stat-number">{{ getTotalExperience() }}</span>
                        <span class="stat-label">Años Exp.</span>
                    </div>
                </div>
            </div>

            <!-- Categorías de Evaluación del Equipo -->
            <div class="team-rating-categories">
                <div *ngFor="let category of teamRatingCategories" class="rating-category-team">
                    <div class="category-header">
                        <span class="category-icon">{{ category.icon }}</span>
                        <h5>{{ category.name }}</h5>
                        <span class="category-rating">
                            {{ getCategoryRating(category.id) }}/5
                        </span>
                    </div>

                    <div class="stars-rating">
                        <div class="stars-container">
                            <button *ngFor="let star of getStarsArray(5)" class="star-btn"
                                [class.active]="isStarActive(star, getCategoryRating(category.id))"
                                (click)="setCategoryRating(category.id, star)">
                                <svg width="28" height="28" viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z" />
                                </svg>
                            </button>
                        </div>
                    </div>

                    <p class="category-description">{{ category.description }}</p>
                </div>
            </div>

            <!-- Comentarios Generales -->
            <div class="team-comments-section">
                <label class="comments-label">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M21 15C21 15.5304 20.7893 16.0391 20.4142 16.4142C20.0391 16.7893 19.5304 17 19 17H7L3 21V5C3 4.46957 3.21071 3.96086 3.58579 3.58579C3.96086 3.21071 4.46957 3 5 3H19C19.5304 3 20.0391 3.21071 20.4142 3.58579C20.7893 3.96086 21 4.46957 21 5V15Z"
                            stroke="currentColor" stroke-width="2" />
                    </svg>
                    Evaluación General del Equipo
                </label>
                <textarea [(ngModel)]="teamComments" [maxlength]="maxCommentLength"
                    placeholder="Evalúa el desempeño general del equipo arbitral, coordinación, consistencia en decisiones..."
                    rows="4" class="team-comments-field">
        </textarea>
                <div class="chars-counter-modal" [class.warning]="getRemainingTeamChars() < 100">
                    {{ getRemainingTeamChars() }}/{{ maxCommentLength }}
                </div>
            </div>
        </div>

        <div class="modal-actions">
            <div class="actions-left">
                <button class="btn-outline" (click)="onClose()">
                    Cancelar
                </button>
            </div>
            <div class="actions-right">
                <button class="btn-primary" (click)="onSubmit()" [disabled]="!isTeamRatingComplete()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M22 2L11 13M22 2L15 22L11 13M22 2L2 10L11 13" stroke="currentColor" stroke-width="2" />
                    </svg>
                    Enviar Evaluación Completa
                </button>
            </div>
        </div>
    </div>
</div>